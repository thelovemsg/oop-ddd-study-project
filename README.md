# [PRD] 선착순 할인 쿠폰 발급 시스템

## 1. 프로젝트 개요 (Overview)
* **목적:** 특정 이벤트 기간 동안 한정된 수량의 할인 쿠폰을 사용자에게 발급한다.
* **배경:** 트래픽이 평소의 수십~수백 배로 폭증하는 '오픈 런' 상황에서, 시스템 다운 없이 안정적으로 트래픽을 처리하고 정확한 수량의 쿠폰을 발급해야 한다.
* **핵심 과제:** 다중 서버 환경에서의 동시성 제어(Race Condition 방어) 및 대기열(Queue) 또는 비동기 처리를 통한 DB 부하 분산.

---

## 2. 보편적인 언어 (Ubiquitous Language)
> 도메인 전문가와 개발자가 동일하게 사용할 핵심 용어

* **Coupon (쿠폰):** 할인 정책과 발급 가능 수량(Inventory), 유효 기간을 가진 마스터 데이터.
* **Issue (발급):** 사용자가 쿠폰을 획득하는 행위.
* **Inventory (재고/잔여 수량):** 현재 발급 가능한 남은 쿠폰의 수.
* **Member (회원):** 쿠폰 발급을 요청하는 주체.

---

## 3. 기능 요구사항 (Functional Requirements)
* **FR-1. 쿠폰 조회:** 사용자는 발급 가능한 쿠폰의 정보와 현재 남은 수량을 확인할 수 있어야 한다.
* **FR-2. 쿠폰 발급 요청:** 사용자는 특정 쿠폰에 대해 발급을 요청할 수 있다.
* **FR-3. 재고 감소:** 쿠폰이 성공적으로 발급되면 해당 쿠폰의 잔여 수량은 1 감소해야 한다.
* **FR-4. 중복 발급 방지:** 1명의 사용자는 동일한 이벤트 쿠폰을 1매만 발급받을 수 있다.
* **FR-5. 발급 종료:** 잔여 수량이 0이 되거나, 이벤트 기간이 종료되면 더 이상 쿠폰을 발급할 수 없다.

---

## 4. 비기능 요구사항 (Non-Functional Requirements)
> 시스템의 진정한 난이도를 결정하는 핵심 엔지니어링 제약 조건

### NFR-1. 정확성 (데이터 정합성 보장)
* 1,000개의 쿠폰을 발행할 때, 10,000명이 동시에 요청하더라도 **정확히 1,000개만 발급**되어야 한다 (초과 발급 절대 불가).
* 동일 사용자가 동시에 여러 번의 요청을 보내더라도(따닥 현상) **1번만 발급**되어야 한다.

### NFR-2. 성능 (Throughput & Latency)
* **목표 처리량:** V1 기준 1,000 TPS, V2(최적화 후) 기준 5,000 TPS 이상.
* **응답 속도:** 사용자의 발급 요청은 평균 200ms 이내에 응답해야 한다.

### NFR-3. 가용성 (High Availability)
* 대규모 트래픽이 RDBMS(MySQL 등)로 직접 쏟아져 DB 커넥션 풀이 고갈되거나 Deadlock이 발생하여 **전체 시스템 장애로 이어지는 것을 방지**해야 한다. (장애 격리)

---

## 5. 단계별 개발 및 학습 마일스톤

* **Phase 1: 도메인 모델링 및 TDD (현재 단계)**
  * 프레임워크나 DB에 의존하지 않는 순수 Java 객체(Entity, Value Object)로 쿠폰 발급의 핵심 도메인 규칙(수량 검증, 상태 변경) 구현.
* **Phase 2: RDBMS 비관적/낙관적 락 적용**
  * DB 락을 이용한 동시성 제어 구현.
  * JMeter를 이용해 병목(Bottleneck) 확인 및 DB 락의 한계 검증.
* **Phase 3: Redis 기반 분산 락 및 대기열 적용**
  * Redis(Redisson 등)를 도입하여 DB 부하를 줄이고 애플리케이션 레벨에서 동시성 제어
